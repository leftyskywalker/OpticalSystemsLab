<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Optics Lab - Modular Engine</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #333; /* Dark background */
            color: white; /* White text */
            font-family: 'Roboto', sans-serif; /* Modern font */
        }
        canvas { 
            display: block; 
        }
        #controls-container { 
            position: absolute; 
            top: 15px; 
            left: 15px; 
            padding: 15px; 
            padding-right: 25px; /* Add more padding on the right */
            background: rgba(0, 0, 0, 0.6); /* Frosted glass effect */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px; 
            min-width: 360px; /* Increased min-width for more space */
            z-index: 10;
            backdrop-filter: blur(10px); /* Glassmorphism */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .control-row { 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center;
            justify-content: flex-start; /* Align items to the start of the flex container */
        }
        label { 
            width: 170px; /* Widened the labels */
            text-align: right; /* Right-align text within the label's fixed width */
            margin-right: 15px; /* Add space between label and control */
            font-size: 0.9em;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 110px; /* Adjusted width */
            height: 5px;
            background: #555;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            vertical-align: middle;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #4a90e2; /* Accent color */
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        select {
            background: #555;
            color: white;
            border: 1px solid #666;
            padding: 5px;
            border-radius: 5px;
            width: 187px; /* Adjusted width */
        }
        .control-row span {
            display: inline-block;
            width: 70px; /* Widened the unit text container */
            text-align: left;
            padding-left: 5px;
        }
        hr { 
            border: 0; 
            border-top: 1px solid #555; 
            margin: 15px 0; 
        }
        .setup-title { 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: #4a90e2; /* Accent color */
            text-align: center; /* Center the setup titles */
        }
        #pixel-viewer-container { 
            position: absolute; 
            bottom: 15px; 
            left: 50%; 
            transform: translateX(-50%); 
            padding: 10px; 
            background: rgba(0,0,0,0.7); 
            border-radius: 8px; 
            text-align: center; 
            z-index: 10; 
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #pixel-viewer-container label { 
            color: white; 
            font-weight: bold; 
            margin-bottom: 8px; 
            display: block;
            width: auto; /* Reset width for this specific label */
            text-align: center;
        }
        #pixel-canvas { 
            background-color: #111; 
            border-radius: 4px;
            border: 1px solid #444;
        }
        #setup-controls .control-row {
            justify-content: flex-start; /* Ensure dynamic controls also align left */
        }
        #setup-controls .control-row label {
             width: 170px; /* Apply same width to dynamic labels */
        }
        #setup-controls .control-row span {
             width: 70px; /* Apply same width to dynamic spans */
             padding-left: 5px;
        }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="controls-container">
        <div class="control-row">
            <label for="setup-select">Optical Setup:</label>
            <select id="setup-select">
                <optgroup label="Visual Models">
                    <option value="laser-model">Laser 3D Model</option>
                </optgroup>
                <optgroup label="Optical Instruments">
                    <option value="czerny-turner">Czerny-Turner Spectrometer</option>
                    <option value="camera-laser">Camera (Laser)</option>
                    <option value="camera-image-object">Camera (Image Object)</option>
                </optgroup>
                <optgroup label="Lenses">
                    <option value="single-lens" selected>Single Convex Lens</option>
                    <option value="two-lens-system">Two Lens System</option>
                </optgroup>
                <optgroup label="Mirrors">
                    <option value="flat-mirror">Flat Mirror</option>
                    <option value="spherical-mirror">Spherical Mirror</option>
                </optgroup>
                <optgroup label="Apertures/Openings">
                    <option value="aperture">Circular Aperture</option>
                    <option value="optical-slit">Optical Slit</option>
                </optgroup>
                <optgroup label="Dispersive Elements">
                    <option value="diffraction-grating">Transmissive Grating</option>
                    <option value="reflective-grating">Reflective Grating</option>
                </optgroup>
            </select>
        </div>
        
        <div class="control-row" id="wavelength-controls">
            <label for="wavelength-select">Light Source:</label>
            <select id="wavelength-select">
                <option value="white" selected>White Light</option>
                <option value="single">Single Wavelength</option>
            </select>
        </div>
        <div class="control-row" id="wavelength-slider-container" style="display: none;">
            <label for="wavelength-slider">Wavelength:</label>
            <input type="range" id="wavelength-slider" min="400" max="700" value="532" step="1">
            <span id="wavelength-value">532 nm</span>
        </div>

        <div class="control-row" id="laser-pattern-controls">
            <label for="laser-pattern-select">Laser Pattern:</label>
            <select id="laser-pattern-select">
                <option value="line" selected>Line</option>
                <option value="radial">Radial</option>
                <option value="cross">Cross</option>
                <option value="disc">Disc</option>
                <option value="heart">Heart</option>
                <option value="star">Star</option>
                <option value="smile">Smile Face</option>
            </select>
        </div>

        <div class="control-row">
            <label for="ray-count-slider">Number of Rays:</label>
            <input type="range" id="ray-count-slider" min="10" max="500" value="100" step="10">
            <span id="ray-count-value">100</span>
        </div>
        
        <div class="control-row" id="sensor-type-container" style="display: none;">
            <label for="sensor-type-select">Sensor Type:</label>
            <select id="sensor-type-select">
                <option value="grayscale" selected>Grayscale</option>
                <option value="bayer">Bayer Filter</option>
                <option value="demosaiced">Demosaiced</option>
            </select>
        </div>
        
        <div class="control-row">
            <label for="bg-toggle">Black Background:</label>
            <input type="checkbox" id="bg-toggle" style="width: auto;">
        </div>

        <hr>
        <div id="setup-controls"></div>
    </div>

    <div id="pixel-viewer-container" style="display: none;">
        <label>Pixel Sensor Array</label>
        <canvas id="pixel-canvas" width="200" height="200"></canvas>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.167.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.167.0/examples/jsm/"
            }
        }
    </script>
    <script type="module" src="main.js"></script>

</body>
</html>